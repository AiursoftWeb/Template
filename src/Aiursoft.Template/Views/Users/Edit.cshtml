@using Aiursoft.Template.Configuration
@using Microsoft.Extensions.Options
@model Aiursoft.Template.Models.UsersViewModels.EditViewModel
@inject IOptions<AppSettings> AppSettings

<h1>@Localizer["Edit User:"] @Model.DisplayName</h1>
<p>@Localizer["Modify user details or manage their assigned roles below."]</p>
<hr />

@if (AppSettings.Value.OIDCEnabled)
{
    <div class="alert alert-warning" role="alert">
        <i class="fa fa-exclamation-triangle"></i>
        <strong>@Localizer["Warning!"]</strong>
        @Localizer["This user account is synchronized with an OpenID Connect (OIDC) provider. Any modifications made here (e.g., to the display name or email) may be overwritten during the next data sync. For permanent changes, please update the user's profile directly on your OIDC provider."]
    </div>
}

<div class="card mb-4">
    <div class="card-header">
        <i class="fas fa-user"></i> @Localizer["Basic Information"]
    </div>
    <div class="card-body">
        <form asp-action="Edit" asp-route-id="@Model.Id">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="row">
                <div class="col-md-6 form-group mb-3">
                    <label asp-for="UserName" class="control-label"></label>
                    <input asp-for="UserName" class="form-control" />
                    <span asp-validation-for="UserName" class="text-danger"></span>
                </div>
                <div class="col-md-6 form-group mb-3">
                    <label asp-for="DisplayName" class="control-label"></label>
                    <input asp-for="DisplayName" class="form-control" />
                    <span asp-validation-for="DisplayName" class="text-danger"></span>
                </div>
                <div class="col-md-6 form-group mb-3">
                    <label asp-for="Email" class="control-label"></label>
                    <input asp-for="Email" class="form-control" />
                    <span asp-validation-for="Email" class="text-danger"></span>
                </div>
                <div class="col-md-12 form-group mb-3">
                    <label asp-for="Password" class="control-label"></label>
                    <input asp-for="Password" class="form-control" />
                    <span asp-validation-for="Password" class="text-danger"></span>
                </div>
            </div>
            <div class="form-group">
                <input type="submit" value="@Localizer["Save User Details"]" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <i class="fas fa-user-tag"></i> @Localizer["Assigned Roles"]
    </div>
    <div class="card-body">
        <form asp-action="ManageRoles" asp-route-id="@Model.Id">
            <div class="row">
                @for (var i = 0; i < Model.AllRoles.Count; i++)
                {
                    <div class="col-md-4 form-check m-1 ms-3">
                        <input type="hidden" asp-for="@Model.AllRoles[i].RoleName" />
                        <input asp-for="@Model.AllRoles[i].IsSelected" class="form-check-input" />
                        <label class="form-check-label" for="@Html.IdFor(m => m.AllRoles[i].IsSelected)">
                            @Model.AllRoles[i].RoleName
                        </label>
                    </div>
                }
            </div>
            <div class="form-group mt-3">
                <input type="submit" value="@Localizer["Save Role Assignments"]" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>

<div class="mt-4">
    <a asp-action="Details" asp-route-id="@Model.Id">@Localizer["Back to Details"]</a> |
    <a asp-action="Index">@Localizer["Back to Users List"]</a>
</div>
